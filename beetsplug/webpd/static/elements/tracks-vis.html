<link rel="import" href="../bower_components/polymer/polymer.html">

<polymer-element name="tracks-vis" attributes="artist tracks xMapping yMapping">
<template>
  <style>
    tracks-vis ^ #render {
      width: 100%;
      height: 100%;
      background-color: white;
    }
  </style>
  <svg id="render"></svg>
</template>
<script>
/**
 * Visualize tracks mainly horizontally in an x,y coordinate-space.
 */
Polymer('tracks-vis', {
  artist: null,
  tracks: null,
  xMapping: 'danceability',
  yMapping: 'valence',
  
  ready: function() {
  },
  artistChanged: function() {
    this.artist.ensureAllTracks().then(function(tracks) {
      this.tracks = tracks;
    }.bind(this), function(err) {
      console.warn('Problem fetching tracks');
    });
  },
  tracksChanged: function() {
    this.render();
  },
  render: function() {
    var tracks = this.tracks;
    if (!tracks) {
      return;
    }
    var svg = d3.select(this.$.render);

    var padding = 4;

    var width = parseInt(svg.style("width")) - padding;
    var height = parseInt(svg.style("height")) - padding;

    var xProp = this.xMapping;
    var x = d3.scale.linear()
      .domain([0, 1])
      .range([padding, padding + width - 1])
      .clamp(true);

    var yProp = this.yMapping;
    var y = d3.scale.linear()
      .domain([0, 1])
      .range([padding, padding + height - 1])
      .clamp(true);

    var color = d3.scale.ordinal()
      .domain(['album', 'single', 'compilation'])
      .range(['red', 'green', 'blue']);

    var trackadots = svg.selectAll('.track')
        .data(tracks.models)
      .enter().append('circle')
        .attr('class', 'track')
        .attr('r', 2)
        .attr('cx', function(track) { return x(track.get(xProp) || 0); })
        .attr('cy', function(track) { return y(track.get(yProp) || 0); })
        .attr('fill', function(track) {
                        return color(track.get('normalbumtype'));
                      })
        .attr('fill-opacity', 0.2)
  }
});
</script>
</polymer-element>
